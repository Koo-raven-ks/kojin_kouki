{% extends "kojin_kouki_kadai/base.html" %}

{% block title %}{{ assignment.title }}{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-md-9">
        <h1>ğŸ“ {{ assignment.title }}</h1>
    </div>
    <div class="col-md-3">
        <a href="{% url 'assignment_update' assignment.pk %}" class="btn btn-warning">ç·¨é›†</a>
        <a href="{% url 'assignment_delete' assignment.pk %}" class="btn btn-danger">å‰Šé™¤</a>
        <a href="{% url 'assignment_list' %}" class="btn btn-secondary">ä¸€è¦§ã«æˆ»ã‚‹</a>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-8">
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0">åŸºæœ¬æƒ…å ±</h5>
            </div>
            <div class="card-body">
                <p><strong>è¬›ç¾©:</strong> <a href="{% url 'lecture_detail' assignment.lecture.pk %}">{{
                        assignment.lecture.name }}</a></p>
                <p><strong>è¬›å¸«:</strong> {{ assignment.lecture.instructor }}</p>
                {% if assignment.description %}
                <p><strong>èª¬æ˜:</strong></p>
                <p>{{ assignment.description|linebreaks }}</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ¼ãƒ‰ -->
        <div class="card mb-3">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h5>
            </div>
            <div class="card-body">
                {% if assignment.status == 'pending' %}
                <p><span class="badge bg-secondary display-6">æœªæå‡º</span></p>
                {% elif assignment.status == 'submitted' %}
                <p><span class="badge bg-info display-6">æå‡ºæ¸ˆã¿</span></p>
                {% else %}
                <p><span class="badge bg-success display-6">æ¡ç‚¹æ¸ˆã¿</span></p>
                {% endif %}
                <p class="card-text"><small class="text-muted">æœ€çµ‚æ›´æ–°: {{ assignment.updated_at|date:"Yå¹´mæœˆdæ—¥ H:i"
                        }}</small></p>
            </div>
        </div>

        <!-- æœŸé™ã‚«ãƒ¼ãƒ‰ -->
        <div class="card mb-3">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">æå‡ºæœŸé™</h5>
            </div>
            <div class="card-body">
                <p class="card-text">
                    <strong>{{ assignment.due_date|date:"Yå¹´mæœˆdæ—¥ H:i" }}</strong>
                </p>
                {% if assignment.status == 'pending' %}
                {% if assignment.is_overdue %}
                <p class="text-danger"><strong>âš ï¸ æœŸé™è¶…é</strong></p>
                {% elif assignment.days_until_due == 0 %}
                <p class="text-danger"><strong>â° æœ¬æ—¥ä¸­ã«æå‡ºï¼</strong></p>
                {% elif assignment.days_until_due < 3 %} <p class="text-warning"><strong>ğŸ“… {{ assignment.days_until_due
                        }}æ—¥å¾Œ</strong></p>
                    {% else %}
                    <p class="text-success"><strong>âœ“ ä½™è£•ã‚ã‚Šï¼ˆ{{ assignment.days_until_due }}æ—¥ï¼‰</strong></p>
                    {% endif %}
                    {% endif %}
            </div>
        </div>

        <!-- å„ªå…ˆåº¦ã‚«ãƒ¼ãƒ‰ -->
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0">å„ªå…ˆåº¦</h5>
            </div>
            <div class="card-body">
                {% if assignment.priority == 'high' %}
                <p><span class="badge bg-danger display-6">é«˜</span></p>
                {% elif assignment.priority == 'medium' %}
                <p><span class="badge bg-warning display-6">ä¸­</span></p>
                {% else %}
                <p><span class="badge bg-info display-6">ä½</span></p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- æå‡ºè¨˜éŒ² -->
{% if submission %}
<div class="card">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0">ğŸ“¬ æå‡ºè¨˜éŒ²</h5>
    </div>
    <div class="card-body">
        <p><strong>æå‡ºæ—¥æ™‚:</strong> {{ submission.submitted_at|date:"Yå¹´mæœˆdæ—¥ H:i" }}</p>
        {% if submission.notes %}
        <p><strong>å‚™è€ƒ:</strong> {{ submission.notes|linebreaks }}</p>
        {% endif %}
        <a href="{% url 'submission_update' submission.pk %}" class="btn btn-sm btn-warning">æå‡ºè¨˜éŒ²ã‚’ç·¨é›†</a>
        <a href="{% url 'submission_delete' submission.pk %}" class="btn btn-sm btn-danger">æå‡ºè¨˜éŒ²ã‚’å‰Šé™¤</a>
    </div>
</div>

<!-- æ¡ç‚¹è¨˜éŒ²ï¼ˆå…ˆç”Ÿç”¨ï¼‰ -->
{% if submission.grading %}
<div class="card mt-3">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0">âœï¸ æ¡ç‚¹è¨˜éŒ²</h5>
    </div>
    <div class="card-body">
        <p><strong>æˆç¸¾:</strong> {{ submission.grading.grade }}ç‚¹</p>
        <p><strong>æ¡ç‚¹æ—¥æ™‚:</strong> {{ submission.grading.graded_at|date:"Yå¹´mæœˆdæ—¥ H:i" }}</p>
        {% if submission.grading.feedback %}
        <p><strong>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯:</strong></p>
        <div class="alert alert-info">{{ submission.grading.feedback|linebreaks }}</div>
        {% endif %}
        <a href="{% url 'grading_update' submission.grading.pk %}" class="btn btn-sm btn-warning">æ¡ç‚¹ã‚’ç·¨é›†</a>
        <a href="{% url 'grading_delete' submission.grading.pk %}" class="btn btn-sm btn-danger">æ¡ç‚¹ã‚’å‰Šé™¤</a>
    </div>
</div>
{% elif submission %}
<div class="card mt-3">
    <div class="card-header">
        <h5 class="mb-0">âœï¸ æ¡ç‚¹è¨˜éŒ²</h5>
    </div>
    <div class="card-body">
        <p class="text-muted">æ¡ç‚¹è¨˜éŒ²ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
        <a href="{% url 'grading_create' submission.pk %}" class="btn btn-success">æ¡ç‚¹ã‚’è¨˜éŒ²ã™ã‚‹</a>
    </div>
</div>
{% endif %}
{% else %}
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">ğŸ“¬ æå‡ºè¨˜éŒ²</h5>
    </div>
    <div class="card-body">
        <p class="text-muted">æå‡ºè¨˜éŒ²ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
        {% if assignment.status == 'pending' %}
        <a href="{% url 'submission_create' assignment.pk %}" class="btn btn-success">æå‡ºã‚’è¨˜éŒ²ã™ã‚‹</a>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}